VaultTest
├── When vault is initialized [TEST-VAULT-INIT]
│   ├── It should have zero totalSupply [TEST-VAULT-INIT-001]
│   ├── It should have zero totalAssets [TEST-VAULT-INIT-002]
│   ├── It should set asset to configured WBTC [TEST-VAULT-INIT-003]
│   └── It should set owner correctly [TEST-VAULT-INIT-004]
├── When depositing assets
│   ├── Given vault is empty [TEST-VAULT-DEPOSIT-EMPTY] [TEST-VAULT-001]
│   │   ├── It should mint shares 1:1 with offset [TEST-VAULT-DEPOSIT-EMPTY-001]
│   │   ├── It should update totalAssets [TEST-VAULT-DEPOSIT-EMPTY-002]
│   │   └── It should emit Deposit event [TEST-VAULT-DEPOSIT-EMPTY-003]
│   ├── Given vault has existing deposits [TEST-VAULT-DEPOSIT-EXISTING] [TEST-VAULT-005]
│   │   ├── It should mint shares according to exchange rate [TEST-VAULT-DEPOSIT-EXISTING-001]
│   │   ├── It should round down shares (favor vault) [TEST-VAULT-DEPOSIT-EXISTING-002]
│   │   └── It should emit Deposit event with correct params [TEST-VAULT-DEPOSIT-EXISTING-003]
│   ├── Given assets is zero [TEST-VAULT-DEPOSIT-ZERO] [TEST-VAULT-003]
│   │   └── It should revert with ZeroAssets [TEST-VAULT-DEPOSIT-ZERO-001]
│   └── Given vault is paused [TEST-VAULT-DEPOSIT-PAUSED] [TEST-VAULT-007]
│       └── It should revert with Paused [TEST-VAULT-DEPOSIT-PAUSED-001]
├── When minting shares
│   ├── Given vault is empty [TEST-VAULT-MINT-EMPTY] [TEST-VAULT-001]
│   │   ├── It should pull 1:1 assets with offset [TEST-VAULT-MINT-EMPTY-001]
│   │   └── It should emit Deposit event [TEST-VAULT-MINT-EMPTY-002]
│   ├── Given vault is non-empty [TEST-VAULT-MINT-EXISTING]
│   │   ├── It should pull rounded up assets [TEST-VAULT-MINT-EXISTING-001]
│   │   └── It should emit Deposit event [TEST-VAULT-MINT-EXISTING-002]
│   ├── Given shares is zero [TEST-VAULT-MINT-ZERO] [TEST-VAULT-003]
│   │   └── It should revert with ZeroShares [TEST-VAULT-MINT-ZERO-001]
│   └── Given vault is paused [TEST-VAULT-MINT-PAUSED] [TEST-VAULT-007]
│       └── It should revert with Paused [TEST-VAULT-MINT-PAUSED-001]
├── When withdrawing assets
│   ├── Given owner has sufficient shares [TEST-VAULT-WITHDRAW-SUCCESS] [TEST-VAULT-002]
│   │   ├── It should burn correct shares (rounded up) [TEST-VAULT-WITHDRAW-SUCCESS-001]
│   │   ├── It should transfer assets to receiver [TEST-VAULT-WITHDRAW-SUCCESS-002]
│   │   └── It should emit Withdraw event [TEST-VAULT-WITHDRAW-SUCCESS-003]
│   ├── Given caller is approved spender [TEST-VAULT-WITHDRAW-APPROVED]
│   │   ├── It should use owner allowance [TEST-VAULT-WITHDRAW-APPROVED-001]
│   │   └── It should reduce allowance [TEST-VAULT-WITHDRAW-APPROVED-002]
│   ├── Given assets is zero [TEST-VAULT-WITHDRAW-ZERO] [TEST-VAULT-003]
│   │   └── It should revert with ZeroAssets [TEST-VAULT-WITHDRAW-ZERO-001]
│   ├── Given insufficient shares [TEST-VAULT-WITHDRAW-INSUFFICIENT]
│   │   └── It should revert with InsufficientShares [TEST-VAULT-WITHDRAW-INSUFFICIENT-001]
│   └── Given vault is paused [TEST-VAULT-WITHDRAW-PAUSED] [TEST-VAULT-007]
│       └── It should revert with Paused [TEST-VAULT-WITHDRAW-PAUSED-001]
├── When redeeming shares
│   ├── Given owner has sufficient shares [TEST-VAULT-REDEEM-SUCCESS] [TEST-VAULT-002]
│   │   ├── It should burn exact shares [TEST-VAULT-REDEEM-SUCCESS-001]
│   │   ├── It should transfer assets (rounded down) [TEST-VAULT-REDEEM-SUCCESS-002]
│   │   └── It should emit Withdraw event [TEST-VAULT-REDEEM-SUCCESS-003]
│   ├── Given caller is approved spender [TEST-VAULT-REDEEM-APPROVED]
│   │   ├── It should use owner allowance [TEST-VAULT-REDEEM-APPROVED-001]
│   │   └── It should reduce allowance [TEST-VAULT-REDEEM-APPROVED-002]
│   ├── Given shares is zero [TEST-VAULT-REDEEM-ZERO] [TEST-VAULT-003]
│   │   └── It should revert with ZeroShares [TEST-VAULT-REDEEM-ZERO-001]
│   └── Given insufficient shares [TEST-VAULT-REDEEM-INSUFFICIENT]
│       └── It should revert with InsufficientShares [TEST-VAULT-REDEEM-INSUFFICIENT-001]
├── When using preview functions [TEST-VAULT-PREVIEW] [TEST-VAULT-004]
│   ├── It should previewDeposit equal convertToShares [TEST-VAULT-PREVIEW-001]
│   ├── It should previewMint round up assets [TEST-VAULT-PREVIEW-002]
│   ├── It should previewWithdraw round up shares [TEST-VAULT-PREVIEW-003]
│   └── It should previewRedeem equal convertToAssets [TEST-VAULT-PREVIEW-004]
├── When using max functions [TEST-VAULT-MAX]
│   ├── It should maxDeposit return max_u256 when not paused [TEST-VAULT-MAX-001]
│   ├── It should maxMint return max_u256 when not paused [TEST-VAULT-MAX-002]
│   ├── It should maxWithdraw return owner convertToAssets [TEST-VAULT-MAX-003]
│   ├── It should maxRedeem return owner balance [TEST-VAULT-MAX-004]
│   └── It should all max functions return 0 when paused [TEST-VAULT-MAX-005]
├── When admin sets strategy [TEST-VAULT-SET-STRATEGY]
│   ├── Given new strategy valid [TEST-VAULT-SET-STRATEGY-VALID]
│   │   ├── It should withdraw all from old strategy [TEST-VAULT-SET-STRATEGY-VALID-001]
│   │   ├── It should deposit all to new strategy [TEST-VAULT-SET-STRATEGY-VALID-002]
│   │   └── It should emit StrategySwitched [TEST-VAULT-SET-STRATEGY-VALID-003]
│   ├── Given new strategy is zero [TEST-VAULT-SET-STRATEGY-ZERO]
│   │   ├── It should withdraw all to vault [TEST-VAULT-SET-STRATEGY-ZERO-001]
│   │   └── It should set strategy to zero [TEST-VAULT-SET-STRATEGY-ZERO-002]
│   ├── Given asset mismatch [TEST-VAULT-SET-STRATEGY-MISMATCH] [TEST-SEC-003]
│   │   └── It should revert with AssetMismatch [TEST-VAULT-SET-STRATEGY-MISMATCH-001]
│   └── Given caller not owner [TEST-VAULT-SET-STRATEGY-UNAUTHORIZED]
│       └── It should revert with Unauthorized [TEST-VAULT-SET-STRATEGY-UNAUTHORIZED-001]
├── When admin calls harvest [TEST-VAULT-HARVEST]
│   ├── Given strategy has profit [TEST-VAULT-HARVEST-PROFIT]
│   │   ├── It should return profit > 0 [TEST-VAULT-HARVEST-PROFIT-001]
│   │   └── It should emit Harvest event [TEST-VAULT-HARVEST-PROFIT-002]
│   ├── Given strategy has loss [TEST-VAULT-HARVEST-LOSS]
│   │   └── It should return loss > 0 [TEST-VAULT-HARVEST-LOSS-001]
│   ├── Given no strategy [TEST-VAULT-HARVEST-NO-STRATEGY]
│   │   └── It should revert with NoStrategy [TEST-VAULT-HARVEST-NO-STRATEGY-001]
│   └── Given caller not owner [TEST-VAULT-HARVEST-UNAUTHORIZED]
│       └── It should revert with Unauthorized [TEST-VAULT-HARVEST-UNAUTHORIZED-001]
├── When admin calls emergency_withdraw [TEST-VAULT-EMERGENCY] [TEST-EMERG-001]
│   ├── Given strategy has assets [TEST-VAULT-EMERGENCY-SUCCESS]
│   │   ├── It should pause vault [TEST-VAULT-EMERGENCY-SUCCESS-001]
│   │   ├── It should recover all assets [TEST-VAULT-EMERGENCY-SUCCESS-002]
│   │   ├── It should clear strategy [TEST-VAULT-EMERGENCY-SUCCESS-003]
│   │   └── It should emit EmergencyWithdraw [TEST-VAULT-EMERGENCY-SUCCESS-004]
│   ├── Given no strategy [TEST-VAULT-EMERGENCY-NO-STRATEGY]
│   │   └── It should return 0 [TEST-VAULT-EMERGENCY-NO-STRATEGY-001]
│   └── Given caller not owner [TEST-VAULT-EMERGENCY-UNAUTHORIZED] [TEST-EMERG-002]
│       └── It should revert with Unauthorized [TEST-VAULT-EMERGENCY-UNAUTHORIZED-001]
├── When ERC20 share operations [TEST-VAULT-ERC20] [TEST-VAULT-006]
│   ├── Given transfer of shares [TEST-VAULT-ERC20-TRANSFER]
│   │   └── It should update balances correctly [TEST-VAULT-ERC20-TRANSFER-001]
│   └── Given approve and transferFrom [TEST-VAULT-ERC20-ALLOWANCE]
│       ├── It should allow third-party redeem [TEST-VAULT-ERC20-ALLOWANCE-001]
│       └── It should reduce allowance [TEST-VAULT-ERC20-ALLOWANCE-002]
└── When admin pauses/unpauses [TEST-VAULT-PAUSE] [TEST-VAULT-007]
    ├── Given owner calls pause [TEST-VAULT-PAUSE-SUCCESS]
    │   └── It should set paused and emit Paused [TEST-VAULT-PAUSE-SUCCESS-001]
    ├── Given owner calls unpause [TEST-VAULT-UNPAUSE-SUCCESS]
    │   └── It should clear paused and emit Unpaused [TEST-VAULT-UNPAUSE-SUCCESS-001]
    └── Given caller not owner [TEST-VAULT-PAUSE-UNAUTHORIZED]
        └── It should revert with Unauthorized [TEST-VAULT-PAUSE-UNAUTHORIZED-001]
